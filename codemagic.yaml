workflows:
  release-workflow:
    name: Publish to Google Play
    max_build_duration: 60
    environment:
      groups:
        - google-play
      vars:
        CM_KEYSTORE: Encrypted(Z0FBQUFBQmcwSUhuRzZ6RjFoU0ZrTFZ6S1QzWmEyZlNPTExYVnQzMzh0dVp5Y18tRk9zYS1hZl9mZmJuSWFLcmtoNWQ3MUpnQ3gxS2Yta0N5ZnRzRjYtSjl1bUkxZFVEZ0lPMXFwZHdtRm9QeW9vNlFxeU1xcTNpc1NjSWFxVlBLbGRKZzNwUy1VQll1djRITFdfWXJGQXpsanQyemhnNUFSLXNRZV8wTDFzVEVKbkJmbXV3cGxpd0ZPdUtaNUk2b0Vjb2kyLWpYN1NZdVdIV21IV3Y5Q2V0SEVpVXowSEg0Rmo0WmRJd3ZucDlFVE9zak9YWWI2YTVhek8xRE13dGktc3pUNndRZlAyWkJZNUlBUkpWc2hIOHFwVzBmdUVuamR5UXd3NmlvUXhsM0FSaHJJMG5uaUdHNmJrQll6eEF5RzFYZGctOHp2Wk5XbkRXNm5SYzdEY1ZpU1hTRllhQ3VHZTBpWkRvdlo1c1Y5RDEtYl95bnU4bzItbXljQXJiTFlmVTNIbGo1QlJTcXUzUjY5cGpiaERxTTVUc3ktdnp0RTZsR1ZxRGwwdzdJdDhMaGlwQVBCbkYyMXJkUzZCYUVFWm90V2NzRzk2Rm93VTdYLXMxRWl1QjdZZ3poWmNNQ2xCelJpMGYta3R6anl2c2FPdkNsRzVkTXRLT2IxbTYyclZpcC0zWGtENDlPTW1QNlhQM0VteFFuSTMzWUI2RWVyU0sxTWpNcE0xZGdua3BhSmZPcmw5NEZ3VUZsYktLZE5UbjM4aVk4Nm8wNExkeXNvZzNSa3hZbVF2OHMtVkZuQVpUTWlFYktnTEdkOVlHOGc1bmpTeDZ1X0JzaU90NTNCaDdSdjFoY0Z0Ykh0Q2NiQ2oxZDk0enMzYlAwTmFMamlmRVllNnFIME8yMTJFN25vdEFpT2Y4VDFnN0NxRWgyUy1idlp6ekVnWTZuc1VNNGdSVU1Db19zdmVVZzFDOW5oLVBEMjlEMnk4OEoyRlNRU3haYnlaQy1QWUVIYnp4dG41cDNwcXRsYXBhRThPU0VhYTB3c2hYV2NaUFlDYjNIWl9VM25QSnJCQ25jdjY0TmRPODE0WlBsa1VGNGdCc2xwa0o3eWZIYXJ3NERIbmlWYnBJWWxFWEhXUHBPM09la0pZQThxZjVxU28xdTRGb3o5cW5wNHlBcWFiVmVEc3RNZjlZT0tJT2tfeEZTTDlBZUpvYWhnNGxmckZ5RVhuZWdUWlpORlNHNXZnRC03VktmYXRLeU5KUllhbGdSYUZFelNYalZMQmJIWDZpUnFfV1k5Y0thcm5SM3V4b3c4c0Y3WERlUGRwSXpFWmVvRll0eUJTUDBra2ZITVh3ZkxwYll3VEZDaWpyTE9uX0FIN01YVGxlWnFEM1FaWlE3OF80dUl4VlE4VldoM2h4SW1zYTlYUHJydDRoX1MwMUhYczkyY00zdERHakZ0SDU2eS1VYUV4dHlqelUwV0VBcWZhLWZ0SU95Wk9SREF0b3hSdFduTGtPVWoxT1RIMXFqZk1ZRDRQc2VEQTN4bm9CeVdaQkJMZUlETGJVSFk1emRoNW50NVZ6R0dINktiOXlsMzZlMUY1bVpaV251QVRjSW5BNXVFWWNmWVlUWXZweERiVWZuOXRPbGtxOW5MRkxNZHdCaFhGMXpKbnIyM1JOTzFob0JYMTgwcmlYOGd3V091RWRyUHVTcDhCd3gtQ3QzeHhBMWhncFdoUHBqbktiSFBYVkVUd1hMLVlJNnhvTWpOZnlMcmZhYlNqWGJLUmtmT1YteF9Mb0pGUUxGeW5FNXlHbU1tdW5UZjVpMmtqU18xWVR1MTZRQi1kVmhnRnNsVUU5QWRndmpHT0c5dFY3NUMzNUplWjVpSXd0ZnZVUG15aEZYRXpKcjlqU1VpMzlPLTU1OWlkQlVJbG0xUS1GV0ZYRXo4ck9vUnl5YjBGRnc1VkxRRF9RV3lNN2FWQ3ZSckppVzBmd2dnaHBQYzF3WnZUQVZqMHJHaERUZWx4NjctVEFBalpic3diUFJ0ZElaYjRmRXpLWkFpYzFIQmlYaGNzZlJmSVpQVUR6UmpweXE0eHV2RW51UlNNR2QwakRCMmJaU2tDeTBNMFBzMWRzbERTVXcwUTZfalpwalVwMEpVVnlXRWlReVE2WjZGN2JMemY0SUdhUHVlUjNoa2hWYmZNWlRCYUdOSDdzODhkT3ZVdklnNnNzMkkxZ2NjQWpsWGg2ZTA4WDBIWEpfdlpJalN4S3dvbGU2cklVWHFZeFFtUFgycFJYak4xWEFrSVlwRXh3ejhaN05vUGgyNnlDaTgzekl0eGU1eEFVeU5HWmJUY1FQT183NmFCamVTcEYxTWFCd3U2bk8wS3c5NFV1LW9vWlByUV9zVWo5V1FJcHNBLWJVY3JjbklZNjZxS2xfb3FjaWJ5TERiMS05RXFUNFpjampPT2FBM05yZXRuOXJITFpja3RKQW56Wnk0c1k1RndySVhVRnN1clNYcVlHTG1WZmpmQjg5c2RWZ2Z5RFFsOHZmTXVZRnM2UzIxTXBiN043R3h2eXVPSlhfeGNBM1ktelpzSDJfMmFxejMyZ0lyd1RoS08yM2dkc1VrYTdfSkV3Q3VNa0REbHBURzROVl93ajBMODhzc3R6SXVPZG1KalhkXzFqbUlROUxqaE8ySjh1Z3dWZFlDOG5UcktoZm5aSjkyTnVaZkhfNUhnTVhTZlNndFhhcmdlSXRoU0RPUXlLNGFmSzB1aFFVSnc3XzdNdlVEZVlRZkwtY1pJUEpIUUhHM2psSnVuTUpWY1J2SUlQNV9DZlNua3p4RExqNmpnZU5pN2lFZU1VYzVCODU0Zy01a056dzBZenI5VmY1SW1XYkdfT3dsVDd0VjRKX1F0MXNoQmxLWElHOXdjMTJLRGJ5S1N6OWxCM2oyM3RLZzFWYlBLUmJJeXdHS0tUUnN6VzZmcDdPc2NwZWZZWU1tcVc4ZnN0THhEaDBxYVRBZFRTd3Q4dGNVeURxWU1OQ1p4YTRTSVQ5NTRYYS05RlNfSF9rRzlCZFhUeTBrUEFNYmh0UF9ndnZxY0pZLVVEZ3NaWEgyLVhlb25QRHE5RE9tQ0FBeUFMVkpaZzdlZ3pnZlZuNFRXSGVRRlZIXzA4elJuTHhWcFAzSXZBMVpXWFR5aU9VRHczUkpUaE8tOVp1cy1vRk9zb3dXQ2Z1Ym9KcGFySDdfcURXM1V3cHRmLU5XanRnWjhxOGFGSWZSX2F2LWNmQzJoak1vWEQ4YUQ5QnpkcjFMUDNkbGk5UFBOWXp2WGxrSEdIRWtQV09mT0VzSFVFTXRTQjdxeTBlenJWbld2TkxnTXg3MkRJV1ZTUGVqRTdxNWZIN2ZMaExLMEliOGlRNFI1b3ZnRUYwV2FQSXU3TEc2aGZjWWFKek5jc3RSczJBd0ZIWXlJR0hQY1RXVjFxYWtWWHFnQ2JaR3lWQTFPOTRrZV9yT2w1VVNoSTFXZFRlY1YyMFlPeHRCWDFaWTBhOTZrYlJVYWZ4ek5ZZExZQTE1aEVpajUzamo3OXRYeEl1ZGlvN01qcnhSZTBRdUJfQlNrS250ZWZtczJUSjJmU1ZrQWg0LTdzbGFpZjYxUTJmWVkzWVc5d3NwaGZMYUM2SVQ2aklsQWVxdXZJMGN4cTFnVTFJcElNRHdSdGVxa1ZDME5pcEkxN21DaE52cGxTTnJrX0FOTmsxc2VpNUZmREdPa0M2OTBLZjVWck9DOFpSOFRONld0ejhZeG94V193eXFsUmVVMTJDOFkyckRROUpXWktuYWpPalJmZHo2V0hWclZubXVGTzExSEJYaVhKZ1VmdGhHcVRQanZDRldBWXdPNXRkZDlSWGNaa1JTdjVidXlHRTJEXzR5U25lNHpyZ0drLWVPMVpsWUl2em9zRW5vVEdWZl8tRlRRSlpSYjhnWGdxZ0pGVDkzRDBiTm8zcWg5YVpDX0p0cmR1aGhpRkZHNkI1ZWJfWTRBUzhFSDFLRURKc2NHSkhCR2dXR3Zpcm1GRm9HZWwzdHhNU1B6ZkN0djRiajlhMUJ0R2MwdG1uQWloRlg1Z3E4ekI1TWwzUHJTaHhReFlzMWFmVzY1NHZ6clNhVmZ0QmpOeURMUlNGTkxGS1NESndQQXhmWUw0MF8tcjNZdUphWGN5N2RGU0xuVVFvak1qSktVcW9LbkEzbHhPN3dnOXZidFFlWUlpajZ2UFJ6MTZLWm0zNFZhNlZvNlNzZ0JuOXhYMUFadFZCUWdpXzF3STVzZUdtRUtyWjZSMzBVUHdDa3FodkFqa1A3cDZqd0p5TkJ5SmNyNUt4UGkyTHBLVHdTUDBqQUVqX3dlVW85Q2duMTM5QjJyXzJiYmtCUWlsX1JEVzhPNGtwVkhmMjJRbVVSQklwTUFNRUpBaUhtbHpQX1A0aFJvbHBVTEloZWthb3Rfa005SzFxUWpSNzhWSE1ERXlnb05mS0V4Yy1HbWZlVXpTdHNySzV5cjVfcmNod2pSVUNFQ1h4VUpITVNHYlpfcmFGUGFNM0NySEhoMmFjSGk4YjF0V1RZTGRLLVJzVEoxQnFWeDhVOGRrZTZQa2VOMDNnRnh3SGhmN3lHc2NXY0VNdHB2eG1TTVppYjhVcWx1Q2ZYWXROcmh4T1BqUjkyaVloU1BvYS1tSDdjTmd3eHR3Yk9aUy1ZQVF0QS1LQ21FbElnXzg4ZlQ1Qm1VVGFuaTVReURUU2JTd3FmaFM0MUU1YmdUMHVmX1dUZWFhTUhaWkp0OFNseFNyTXBTOHFXQ00tSkx0Zko2em4zX3YwaHdzcHZZT0kwdWlhanZ1TFpvY1FUNTllVUVoRDY4LUdWcDlLTDhJemxlRjBmeFpNY0ZQMHU5TVhmNGNyVnVmM3hzTzVOTHhIT3J4U2FrdE56X25wTGhwZHZCRjFFVFc0Zk5wUHh5ajBRLVJFbWlseXRYZUpQXzRPZjVNOWh2dmJUb0cyREx1REFYSFJUdmVWc1RxRDVqN2dGWUplY056Z1NvTU5HNk1ydmt5MW9EUWdOS3Q3STNiQVNrMDZIRlUwZG1vZlUzQWVaTTFGWXlnOUZCOW9QRTBpWWVxYXJKMVNBYllVOUNXR29WaE1JVXFGWlZqclF1bDVDZXlrVTNITHFrN3J4TGU5Yzg4ZGhPRFA4Y1dzdjgtb0EwVmNUUThLRU1DZDBYMkVNR1VLTERaV212V1hfNVR4MnFOWEZobjczaTJNM0Nla0p1UzBfUTRsdUwyVE51X3VLVHROMGVMa0JxMkdiZE05YzJiVlMxTGJZZ0FOTGpwX1ltZk1IdGxsZ1B2NVVMQ1djbjR2R3F6Z0JUWlV6cmhEMVVNMVBYYmItQWJJaW5LaGVKcFY1cE5QSDlqVF9pUGdqRXRNTUx2V3NWUl9IZlVHd3FCUlFvblFkWnByQXZybHZBeXpnaF8zWlpBcTN1VXBMZTUtMTFha3ZVcFNZbjE4dmEteFRJb3A3Q0M2c3EwempWOERISHdCWkY5QW1MV3J0Z0JESnM9)
        CM_KEYSTORE_PASSWORD: Encrypted(Z0FBQUFBQmcwSUhMSzRicGJNRDJlT1FrREVEUWNMck9DRXFpY1hQVVJOVWl5QldWN05YUzRtWTdTNWVCOHNrTExSVVRoVlVyTkhXRGRXT1NfVnF5TzAzcVVUams3cjZvWlE9PQ==)
        CM_KEY_ALIAS_USERNAME: TurskyiApps
        CM_KEY_ALIAS_PASSWORD: Encrypted(Z0FBQUFBQmcwSUl4Y3ZoUEthUFltYlV4SW5pTHcxalBCbDZkLS1PZGNhM3A2TFlBUG5PTk9la1RtR3JhclRaYjVKSVpOaUdNZHd2d2NhZXJiT1lzOWtjZmtQVGFkbGpKOWc9PQ==)
        JAVA_HOME: /Library/Java/JavaVirtualMachines/zulu-17.jdk/Contents/Home # Path to Java 17
    triggering:
      events:
        - push
      branch_patterns:
        - pattern: master
          include: true
          source: true
    scripts:
      - |
        # set up release keystore
        echo $CM_KEYSTORE | base64 --decode > /tmp/keystore
        cat >> "$FCI_BUILD_DIR/key.properties" <<EOF
        storePassword=$CM_KEYSTORE_PASSWORD
        keyPassword=$CM_KEY_ALIAS_PASSWORD
        keyAlias=$CM_KEY_ALIAS_USERNAME
        storeFile=/tmp/keystore
        EOF
        ./gradlew bundleRelease
    artifacts:
      - presentation/build/outputs/bundle/release/presentation-release.aab
    publishing:
      google_play:
        credentials: $GCLOUD_SERVICE_ACCOUNT_CREDENTIALS
        track: production